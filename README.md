# fl-cfRNAmeta

A repository for preprocessing, harmonizing, and analyzing metadata and data from public cfRNA-seq datasets. This project provides scripts and configuration files for standardizing sample and batch metadata, and processing the data in order to obtain final outputs for manuscript "An assessment of RNA-Seq experimental workflows for plasma cell-free transcriptome profiling".
---

## Repository Structure

```
fl-cfRNAmeta/
├── .gitignore
├── README.md
├── nextflow/
│   ├── base_params.yml
│   ├── base.config
│   ├── hg38_gencodev39_params.yml
│   ├── non_smarter_reverse_params.yml
│   ├── non_smarter_unstranded_params.yml
│   ├── non_smarter.config
│   ├── smarter_v2_params.yml
│   ├── smarter_v3_params.yml
│   ├── smarter.config
│   └── two-color-illumina.config
├── sra_metadata/
│   └── ...
├── src/
│   ├── boxplots_fig2.R
│   ├── dataset_mappings.json
│   ├── fig_1a_stacked_barplot.R
│   ├── fig_1b_heatmap.R
│   ├── gene_coverage_profile_fig2_tmpH.ipynb
│   ├── join_count_matrix_and_qc_table.ipynb
│   ├── merge_fastqs_array_isolate.sh
│   ├── preprocess_metadata_functions.py
│   └──sra_columns_mapping.py
├── tables/
│   ├── cfRNA-meta_per_batch_metadata.tsv
│   ├── cfRNA-meta_per_sample_metadata.tsv
│   ├── sampleinfo_all-batches.tsv
│   ├── sampleinfo_external_and_internal_datasets.tsv
│   └── taxa_simple_df_w_batch.tsv
└── ...
```

---

## Contents

### 1. `src/` scripts and notebooks

- **`preprocess_metadata_functions.py`**  
  Main script for preprocessing and harmonizing metadata from multiple cfRNA-seq studies.  
  - Loads and standardizes sample-level metadata from various studies.
  - Merges with dataset-level metadata.
  - Applies dataset-specific cleaning, exclusion, and annotation logic.
  - Outputs harmonized per-sample and per-batch metadata tables.

- **`sra_columns_mapping.py`**  
  Helper functions for renaming and standardizing column names and values across metadata tables.

- **`dataset_mappings.json`**  
  JSON file with mappings for dataset names, colours, orders, or values used across scripts.

- **`boxplots_fig2.R`**  
  R script for generating boxplots for Figure 2 of the associated analysis.

- **`fig_1a_stacked_barplot.R`**  
  R script for creating a stacked barplot for Figure 1A.

- **`fig_1b_heatmap.R`**  
  R script for generating a heatmap for Figure 1B.

- **`gene_coverage_profile_fig2_tmpH.ipynb`**  
  Jupyter notebook for plotting gene coverage profiles, for Figure 2.

- **`join_count_matrix_and_qc_table.ipynb`**  
  Jupyter notebook for merging sliced count matrices and QC tables into a single matrix or QC table file.

- **`merge_fastqs_array_isolate.sh`**  
  Shell script for merging FASTQ files by array or isolate.

---

### 2. `nextflow/`

- **Purpose:**  
  Contains configuration files and parameter sets for running fl-rnaseq Nextflow pipeline with each dataset.
- **Files:**
  - `base.config`, `base_params.yml`: Base Nextflow configuration and parameters.
  - `smarter.config`, `smarter_v2_params.yml`, `smarter_v3_params.yml`: Configs for SMARTer protocols.
  - `non_smarter.config`, `non_smarter_reverse_params.yml`, `non_smarter_unstranded_params.yml`: Configs for non-SMARTer protocols.
  - `hg38_gencodev39_params.yml`: Parameters for hg38/Gencode v39 reference.
  - `two-color-illumina.config`: Config for two-color Illumina sequencing.

---

### 3. `sra_metadata/`

- **Purpose:**  
  Stores raw and preprocessed metadata files for each study, as well as supplementary tables and GEO series matrix files.
- **Files:**
  - `<dataset>_metadata.csv` / `<dataset>_metadata_preprocessed.csv`: Raw and processed sample metadata.
  - `<dataset>_supp_table_*.xlsx` / `.tsv`: Supplementary tables with additional sample/batch info.
  - `<dataset>_GSE*_series_matrix.txt`: GEO series matrix files for extracting sample annotations.

---

### 4. `tables/`

Contains output and intermediate tables generated by the preprocessing scripts and downstream analyses:

- **`cfRNA-meta_per_sample_metadata.tsv`**  
  Harmonized per-sample metadata table for all included cfRNA-seq datasets.

- **`cfRNA-meta_per_batch_metadata.tsv`**  
  Harmonized per-batch metadata table summarizing batch-level information.

- **`sampleinfo_all-batches.tsv`**  
  Sample information table including all batches.

- **`taxa_simple_df_w_batch.tsv`**  
  Simplified taxa table for downstream taxonomic analyses.

---

## License

See LICENSE file for details.

---

## Contact

For questions or contributions, please open an issue.